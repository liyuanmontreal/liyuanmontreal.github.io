**对应章节:** [https://pierrelucbacon.com/rlbook/ssm/](https://pierrelucbacon.com/rlbook/ssm/)

# 用于决策的动态模型

$$
(\mathbf{x}_0,\ \{\mathbf{u}_t\},\ \{\mathbf{d}_t\}) \ \longmapsto\ \{\mathbf{x}_t,\ \mathbf{y}_t\}_{t=0:T},
$$

-  **模型目的**：不仅要描述相关性，更要描述系统如何**随时间演化**，以及在我们选择的**控制输入**下如何响应（用于规划、评估策略与交互式学习）。  
- **轨迹生成器视角**：给定初始状态、控制序列与外生扰动，模型应能**前向滚动**出状态与观测的轨迹；这是决策与控制的“骨架”。  
- **控制 vs. 扰动**：区分我们能施加的 **控制输入**（u）与必须适应的 **外生驱动**（d），明确“能控制的部分 vs. 被动的部分”。  
- **两大设计压力**：  
  1) **对输入的可响应性**：模型要暴露与决策相关的“杠杆”；  
  2) **记忆管理（状态）**：用一个紧凑变量 **state** 概括“到目前为止的重要信息”，以便逐步仿真与控制。  
- **状态空间观**：把动力学写成状态推进（离散或连续时间），并允许与估计器、控制器**模块化组合**；线性化是**为透明与速度做的建模折中**，不是“世界本来线性”。  
- **离散 vs. 连续时间**：实现大多离散（采样/执行），但**连续时间**有助于表达物理假设、跨尺度推理与守恒/不变性；两种表述可相互转化（数值离散化、零阶保持等）。  

 
# 状态空间视角

- **核心思想**：  
  大多数动力学模型（无论来自物理还是数据驱动）都可以写成**状态空间形式**。  
  其中：
  - 状态 $\mathbf{x}$：包含了预测和控制所需的全部“记忆”；  
  - 控制 $\mathbf{u}$：是我们能施加的决策输入；  
  - 外部驱动 $\mathbf{d}$：是外界的扰动；  
  - 观测 $\mathbf{y}$：是我们能测得的输出。  

- **离散时间与连续时间**：  
  - 离散时间：数字控制器以固定步长采样与决策。  
 $\mathbf{x}_{t+1} = f_t(\mathbf{x}_t, \mathbf{u}_t), \qquad \mathbf{y}_t = h_t(\mathbf{x}_t, \mathbf{u}_t).$
  - 连续时间：物理过程以微分方程形式演化。  
 $\dot{\mathbf{x}}(t) = f(\mathbf{x}(t), \mathbf{u}(t)), \qquad \mathbf{y}(t) = h(\mathbf{x}(t), \mathbf{u}(t)).$

 两者可通过**数值离散化**或**零阶保持**和**插值**互相转化。  

- **物理系统的混合特性**：  
  实际中，控制软件发出离散命令（数字信号），经过 DAC 转为模拟电压驱动系统；  
  传感器信号经 ADC 离散化后传入控制器。  
  因此，**连续动力学 + 离散执行**几乎无处不在。  

- **为什么仍需连续时间建模？**  
  - 显式地表达物理假设（如能量守恒、不变性）；  
  - 连接领域知识（微分方程形式）；  
  - 支持多时间尺度推理；  
  - 理解离散化误差与系统结构。  

- **线性化表示**：  
  若 $f$ 和 $h$ 线性，则：  

$\dot{\mathbf{x}} = A\mathbf{x} + B\mathbf{u}, \qquad \mathbf{y} = C\mathbf{x} + D\mathbf{u}.$

  线性假设并非“世界是线性的”，而是一种**透明性与速度的建模折中**。  
  对机器学习者而言，它类似于 **RNN**：状态是隐藏向量，输入是控制信号，输出层是读出函数。

- **频域与时域的视角**：  
  经典控制通过 **Laplace / Z-变换** 将微分方程转为代数方程以分析稳定性；  
  而在学习与仿真中，**时域状态空间形式** 更通用、可扩展。  

# 确定性动力学示例：暖通空调控制  

- **情景背景：**  
  蒙特利尔的冬天，室外温度 -20°C，室内恒温系统试图维持舒适。  
  系统包括空气、墙体、加热设备、外界天气，是一个典型的**热动力系统（thermal dynamical system）**。

- **目标：**  
  用最少的参数捕捉建筑热量流动的主要物理机制。
---

### 1. 单区单容模型（1R1C 模型）

- 假设整个房间是一个整体的热容体，温度随时间变化满足：
$$
\dot{\mathbf{x}}(t) = -\frac{1}{RC}\mathbf{x}(t) + \frac{1}{RC}\mathbf{d}(t) + \frac{1}{C}\mathbf{u}(t).
$$
  其中：
  - \(x(t)\)：室内温度  
  - \(u(t)\)：加热功率（控制输入）  
  - \(d(t)\)：室外温度（扰动）  
  - \(R\)：热阻（墙体隔热能力）  
  - \(C\)：热容（空气热容量）  

- **解释：**  
  该系统是连续时间线性系统，可写为：  

$$
\dot{\mathbf{x}}(t) = \mathbf{A}\mathbf{x}(t) + \mathbf{B}\mathbf{u}(t) + \mathbf{E}\mathbf{d}(t), \quad \mathbf{y}(t) = \mathbf{C}\mathbf{x}(t),
$$

---

### 2. 双区双容模型（2R2C 模型）

- 墙体也具有热容，应纳入建模，形成“空气 + 墙体”耦合系统：
$$
\mathbf{A} = \begin{bmatrix}
-\frac{1}{R_{\text{ia}}C_{\text{air}}} & \frac{1}{R_{\text{ia}}C_{\text{air}}} \\
\frac{1}{R_{\text{ia}}C_{\text{wall}}} & -\left(\frac{1}{R_{\text{ia}}} + \frac{1}{R_{\text{wo}}}\right) \frac{1}{C_{\text{wall}}}
\end{bmatrix},
\quad
\mathbf{B} = \begin{bmatrix} \frac{1}{C_{\text{air}}} \\ 0 \end{bmatrix},
\quad
\mathbf{E} = \begin{bmatrix} 0 \\ \frac{1}{R_{\text{wo}}C_{\text{wall}}} \end{bmatrix},
\quad
\mathbf{C} = \begin{bmatrix} 1 & 0 \end{bmatrix}.
$$

  写成状态空间形式：  
  \[
  \dot{x} = A x + B u + E d, \quad y = Cx
  \]

- **矩阵解释：**
  - \(A_{11}\)：空气对墙体的热损失  
  - \(A_{12}\)：空气从墙体获得热量  
  - \(A_{21}\)：墙体从空气获得热量  
  - \(A_{22}\)：墙体对空气和外界的综合热损失  

- **物理含义：**  
  墙体储热 → 延迟加热响应（热惯性）。  
  系统更平滑、更稳定，对扰动响应更慢但更稳健。

---

### 3. 控制输入

- 控制变量 \(\mathbf{u}(t)\) 的含义取决于我们想要达成的目标以及我们在实践中能够实现的目标。：
  - 连续功率输入（物理建模）；
  - 温度设定点（系统级控制）；
  - 二值信号（开关控制）；
  - PID 控制逻辑（实际设备中）。  

- **抽象层级决定模型复杂度**：  
  不同层级下的建模方式不同——  
  若目标是控制设计 → 需全闭环建模；  
  若目标是策略学习 → 抽象简化更稳健。

---

### 4. 为什么使用 RC 物理模型？

- **可解释性**：参数对应物理量（R、C），便于理解与验证。  
- **可识别性**：少量数据即可校准，符合物理约束（热流方向、平滑响应）。  
- **可重用性**：修改容易（换窗、保温），仿真计算量小。  
- **可扩展性**：多房间 → 图结构热网络，节点代表温度，边代表热流。  
- **与黑箱模型对比：**  
  - 黑箱（如 Neural ODE）虽灵活，但需大量数据；
  - RC 模型更稳健、更具解释性；
- 实际常采用“结构 + 残差学习”混合方法。


#从确定性到随机性

- **背景：**  
  前面介绍的模型都是确定性的：给定初始状态与控制输入序列，系统演化是唯一的。  
  然而现实中，系统存在各种不确定性：噪声、参数漂移、未建模的外界影响等。  
  因此我们引入**随机动力学模型（stochastic dynamics model）**来刻画这些不确定性。

### 1. 函数 + 噪声（Function + Noise）

最直接的扩展是在确定性模型中加入噪声项：  
$$
\mathbf{x}_{t+1} = f_t(\mathbf{x}_t, \mathbf{u}_t, \mathbf{w}_t), \quad \mathbf{w}_t \sim p_{\mathbf{w}}.
$$
若噪声是高斯加性：  
$$
\mathbf{x}_{t+1} = A\mathbf{x}_t + B\mathbf{u}_t + \mathbf{w}_t, \quad \mathbf{w}_t \sim \mathcal{N}(0, Q).
$$
这就是标准的线性高斯模型（用于卡尔曼滤波）。 

噪声也可以是非高斯：
$$
\mathbf{x}_{t+1} = f(\mathbf{x}_t, \mathbf{u}_t) + \mathbf{w}_t, \quad \mathbf{w}_t \sim \text{Laplace}, \ \text{or}\ \text{Student-t},
$$

这被称为**卷积模型**：下一状态分布是噪声分布的平移版本，以确定性预测为中心。
它是**前推测度**的一个特例：来自 $\mathbf{w}_t$ 的随机性通过函数 $f$ “前推”以产生结果分布。

备注：
前推测度的核心思想是——“随机性的传递（propagation of randomness）”。
随机性通过函数传递。我们不直接建模输出的分布，而是通过已知的输入分布 + 系统函数，计算出输出分布。
